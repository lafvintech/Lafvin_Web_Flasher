<!--
    LAFVIN ESP Web Flasher
    基于 esptool-js 的在线烧录工具
-->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LAFVIN - Web Flasher</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@4.19.0/css/xterm.css">
</head>
<body>
    <!-- 头部 -->
    <header>
        <div class="logo">
            <i class="fas fa-microchip logo-icon"></i>
            <span>LAFVIN</span>
        </div>
        <div class="header-right">
            <nav>
                <a href="#" class="nav-button">Home</a>
                <a href="#" class="nav-button">Support</a>
            </nav>
            <div id="theme-switcher" class="theme-switcher">
                <i class="fas fa-moon"></i>
            </div>
        </div>
    </header>

    <!-- 主内容 -->
    <main>
        <section class="hero">
            <h1 class="main-title">Flash directly from the web</h1>
            <p class="subtitle">Connect your device, select your model and board version, and start flashing immediately. No setup required.</p>
        </section>

        <!-- 三步选择器 -->
        <section class="stepper">
            <div id="step-1" class="step active">
                <div class="step-icon"><i class="fas fa-desktop"></i></div>
                <div id="select-device-btn" class="step-content step-button">
                    <span>Select device</span>
                </div>
            </div>
            <div id="step-2" class="step">
                <div class="step-icon"><i class="fas fa-microchip"></i></div>
                <div class="step-content">
                    <div class="dropdown-container">
                        <select id="firmware-select" disabled>
                            <option value="">Select firmware</option>
                        </select>
                    </div>
                </div>
            </div>
            <div id="step-3" class="step">
                <div class="step-icon"><i class="fas fa-code-branch"></i></div>
                <div class="step-content">
                    <div class="dropdown-container">
                        <select id="version-select" disabled>
                            <option value="">Select version</option>
                        </select>
                    </div>
                </div>
            </div>
        </section>

        <!-- 操作区 -->
        <section class="actions">
            <div class="controls-grid">
                <div class="baud-rate-selector">
                    <label for="baud-rate-select">Flash Baud Rate:</label>
                    <select id="baud-rate-select">
                        <option value="115200">115200</option>
                        <option value="230400">230400</option>
                        <option value="460800">460800</option>
                        <option value="921600" selected>921600</option>
                    </select>
                </div>
                <div class="erase-checkbox-container">
                    <input type="checkbox" id="erase-flash-checkbox" checked>
                    <label for="erase-flash-checkbox">Erase Flash</label>
                </div>
                <button id="connect-btn" class="action-btn"><i class="fas fa-link"></i> Connect</button>
                <button id="flash-btn" class="action-btn" disabled><i class="fas fa-bolt"></i> Flash</button>
                <button id="toggle-console-btn" class="action-btn"><i class="fas fa-terminal"></i> Open Console</button>
                <button id="serial-port-info-btn" class="action-btn" disabled><i class="fas fa-info-circle"></i> Serial Monitor</button>
            </div>
        </section>

        <!-- 终端控制台 -->
        <section class="terminal-section hidden">
            <div id="terminal-log"></div>
        </section>
    </main>

    <!-- 页脚 -->
    <footer>
        <div class="footer-copyright">
            © 2025 LAFVIN
            <span style="margin: 0 0.5rem; opacity: 0.5;">|</span>
            Powered by <a href="https://github.com/espressif/esptool-js" target="_blank" class="footer-link">esptool-js</a>
        </div>
    </footer>

    <!-- 设备选择模态框 -->
    <div id="device-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Select device</h2>
                <button id="close-modal-btn" class="close-btn">&times;</button>
            </div>
            <div class="modal-main">
                <button class="modal-nav-arrow left-arrow"><i class="fas fa-chevron-left"></i></button>
                <div class="device-carousel">
                    <div id="device-list" class="device-list"></div>
                </div>
                <button class="modal-nav-arrow right-arrow"><i class="fas fa-chevron-right"></i></button>
            </div>
        </div>
    </div>

    <!-- 串口监视器模态框 -->
    <div id="serial-info-modal" class="modal-overlay">
        <div class="modal-content serial-monitor-modal-content">
            <div class="modal-header">
                <h2>Serial Monitor</h2>
                <button id="close-serial-info-modal-btn" class="close-btn">&times;</button>
            </div>
            <div class="modal-main">
                <div id="serial-info-content" class="serial-info-content">
                    <div class="baud-rate-selector">
                        <label for="modal-baud-rate-select">Monitor Baud Rate:</label>
                        <select id="modal-baud-rate-select">
                            <option value="9600">9600</option>
                            <option value="115200" selected>115200</option>
                            <option value="230400">230400</option>
                            <option value="460800">460800</option>
                            <option value="921600">921600</option>
                        </select>
                        <button id="clear-terminal-btn" class="action-btn small-btn" style="margin-left: auto;"><i class="fas fa-trash-alt"></i> Clear</button>
                    </div>
                    <div id="serial-monitor-terminal" class="serial-monitor-terminal"></div>
                    <div class="serial-send-area">
                        <input type="text" id="serial-send-input" placeholder="Type command..." />
                        <button id="serial-send-btn" class="action-btn small-btn">Send</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.js"></script>
    <script type="module" src="esptool-integration.js"></script>
    <script type="module" src="script.js"></script>
</body>
</html>
